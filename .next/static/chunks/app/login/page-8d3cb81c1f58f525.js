(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{1337:(e,r,t)=>{"use strict";t.d(r,{A_:()=>d,Yq:()=>i,cn:()=>l,r6:()=>o});var s=t(9722),a=t(622);function l(...e){return(0,a.QP)((0,s.$)(e))}function n(e){return e instanceof Date?e:new Date(e)}function i(e){let r=n(e);return Number.isNaN(r.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric"}).format(r)}function o(e){let r=n(e);return Number.isNaN(r.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(r)}let d=["المبتدئ","جزء عم","جزء تبارك","ثلث القرآن","نصف القرآن","ثلاثة أرباع القرآن","الحفظ الكامل"]},2309:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>x});var s=t(5155),a=t(8500),l=t.n(a),n=t(3321),i=t(2115),o=t(8434),d=t(4206),u=t(4426),c=t(3602),m=t(7236),h=t(5446);let f=(0,m.U)();function x(){let e=(0,n.useRouter)(),r=(0,i.useRef)(!1),[t,a]=(0,i.useState)(!1),[m,x]=(0,i.useState)(""),[b,p]=(0,i.useState)(""),[g,w]=(0,i.useState)({});(0,i.useEffect)(()=>{if(r.current)return;r.current=!0;let e=new URLSearchParams(window.location.search).get("error");e&&o.Ay.error(`تعذر إكمال المصادقة. (${e})`)},[]);let y=async r=>{let t;if(r.preventDefault(),t={},m.trim()?/^\S+@\S+\.\S+$/.test(m.trim())||(t.email="صيغة البريد الإلكتروني غير صحيحة."):t.email="البريد الإلكتروني مطلوب.",b||(t.password="كلمة المرور مطلوبة."),w(t),0!==Object.keys(t).length)return void o.Ay.error("يرجى تصحيح أخطاء النموذج.");a(!0);try{let{data:r,error:t}=await f.auth.signInWithPassword({email:m.trim(),password:b});if(t)throw t;if(!r.user)throw Error("تعذر التحقق من المستخدم بعد تسجيل الدخول.");let{profile:s}=await (0,h.R)();if(o.Ay.success("تم تسجيل الدخول بنجاح."),!s?.school_id||!s?.role)return void e.replace("/onboarding");e.replace("/dashboard")}catch(a){let e,r,t,s;console.warn("[auth:login]",e=function(e,r){if(e instanceof Error&&e.message)return e.message;if("object"==typeof e&&null!==e&&"message"in e){let r=e.message;if("string"==typeof r&&r.trim())return r}return r}(a,"تعذر تسجيل الدخول.")),r=(t=(s=e.toLowerCase()).toLowerCase()).includes("could not find the table")&&t.includes("profiles")||t.includes("schema cache")&&t.includes("profiles")||t.includes("relation")&&t.includes("profiles")&&t.includes("does not exist")?"تسجيل الدخول نجح لكن قاعدة البيانات غير مهيأة (جدول profiles غير موجود).":s.includes("invalid login credentials")?"البريد الإلكتروني أو كلمة المرور غير صحيحة.":s.includes("email not confirmed")?"يرجى تأكيد بريدك الإلكتروني قبل تسجيل الدخول.":s.includes("too many requests")?"محاولات كثيرة، حاول مرة أخرى بعد قليل.":"تعذر تسجيل الدخول. تحقق من بياناتك ثم أعد المحاولة.",o.Ay.error(`${r} (${e})`)}finally{a(!1)}};return(0,s.jsx)(d.A,{title:"تسجيل الدخول",subtitle:"أدخل بياناتك للوصول إلى لوحة التحكم",footer:(0,s.jsxs)(s.Fragment,{children:["ليس لديك حساب؟"," ",(0,s.jsx)(l(),{href:"/register",className:"font-semibold text-brand-700 hover:text-brand-600",children:"إنشاء حساب"})]}),children:(0,s.jsxs)("form",{onSubmit:y,className:"space-y-4",dir:"rtl",children:[(0,s.jsx)(c.A,{id:"login-email",label:"البريد الإلكتروني",type:"email",value:m,onChange:x,error:g.email}),(0,s.jsx)(c.A,{id:"login-password",label:"كلمة المرور",type:"password",value:b,onChange:p,error:g.password}),(0,s.jsx)("div",{className:"text-left",children:(0,s.jsx)(l(),{href:"/forgot-password",className:"text-sm font-medium text-brand-700 hover:text-brand-600",children:"نسيت كلمة المرور؟"})}),(0,s.jsx)(u.A,{type:"submit",disabled:t,children:t?"جارٍ تسجيل الدخول...":"دخول"})]})})}},3321:(e,r,t)=>{"use strict";var s=t(4645);t.o(s,"useParams")&&t.d(r,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(r,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}})},3602:(e,r,t)=>{"use strict";t.d(r,{A:()=>l});var s=t(5155),a=t(1337);function l({id:e,label:r,value:t,error:l,helper:n,onChange:i,className:o,...d}){return(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{htmlFor:e,className:"block text-sm font-semibold text-gray-700",children:r}),(0,s.jsx)("input",{id:e,value:t,onChange:e=>i(e.target.value),className:(0,a.cn)("min-h-[44px] w-full rounded-xl border border-gray-200 bg-white px-3 py-2 text-[16px] outline-none ring-brand-600/20 transition focus:ring",l?"border-red-300":"",o),...d}),l?(0,s.jsx)("p",{className:"text-sm text-red-600",children:l}):n?(0,s.jsx)("p",{className:"text-xs text-gray-500",children:n}):null]})}},4206:(e,r,t)=>{"use strict";t.d(r,{A:()=>i});var s=t(5155),a=t(8500),l=t.n(a),n=t(8992);function i({title:e,subtitle:r,children:t,footer:a}){return(0,s.jsx)("main",{dir:"rtl",className:"min-h-screen bg-app",children:(0,s.jsxs)("div",{className:"grid min-h-screen lg:grid-cols-2",children:[(0,s.jsx)("section",{className:"relative overflow-hidden bg-brand-600 bg-mosque-pattern p-6 text-white lg:p-10",children:(0,s.jsxs)("div",{className:"mx-auto flex h-full w-full max-w-xl flex-col justify-between",children:[(0,s.jsxs)("div",{className:"rounded-2xl bg-white/10 p-4 backdrop-blur-sm",children:[(0,s.jsx)("p",{className:"text-sm text-white/90",children:"منصة المدارس القرآنية"}),(0,s.jsx)("h2",{className:"mt-2 text-2xl font-extrabold",children:"إدارة مدرسية بطابع عربي واضح"})]}),(0,s.jsxs)("div",{className:"relative hidden h-64 lg:block",children:[(0,s.jsx)("div",{className:"absolute bottom-0 right-0 h-40 w-40 rounded-t-full border-2 border-white/25"}),(0,s.jsx)("div",{className:"absolute bottom-0 right-20 h-56 w-56 rounded-t-full border-2 border-white/20"}),(0,s.jsx)("div",{className:"absolute bottom-0 right-44 h-32 w-32 rounded-t-full border-2 border-white/20"}),(0,s.jsx)("div",{className:"absolute bottom-0 left-12 h-20 w-16 rounded-t-full bg-white/10"}),(0,s.jsx)("div",{className:"absolute bottom-20 left-[5.25rem] h-8 w-2 bg-white/30"})]})]})}),(0,s.jsxs)("section",{className:"relative flex items-center justify-center px-4 py-8 md:px-8",children:[(0,s.jsx)(l(),{href:"/",className:"absolute right-6 top-6 text-xl font-extrabold text-brand-700",children:"أبشر"}),(0,s.jsxs)(n.A,{className:"w-full max-w-[480px] bg-[#FFFCF7] p-6 md:p-8",children:[(0,s.jsxs)("header",{className:"mb-6 space-y-2 text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-extrabold text-brand-700 md:text-3xl",children:e}),r?(0,s.jsx)("p",{className:"text-sm leading-7 text-gray-600",children:r}):null]}),(0,s.jsx)("div",{className:"space-y-4",children:t}),a?(0,s.jsx)("footer",{className:"mt-6 text-center text-sm text-gray-600",children:a}):null]})]})]})})}},4426:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var s=t(5155),a=t(1337);let l={primary:"bg-brand-600 text-white hover:bg-brand-700",secondary:"bg-white text-brand-700 border border-brand-600 hover:bg-primary-50",danger:"bg-red-600 text-white hover:bg-red-700"};function n({variant:e="primary",className:r,type:t="button",...n}){return(0,s.jsx)("button",{type:t,className:(0,a.cn)("inline-flex min-h-[44px] w-full items-center justify-center rounded-lg px-4 py-2 text-sm font-semibold transition disabled:cursor-not-allowed disabled:opacity-60",l[e],r),...n})}},5446:(e,r,t)=>{"use strict";t.d(r,{R:()=>n});let s=(0,t(7236).U)();function a(e){let r=e.toLowerCase();return r.includes("row-level security")||r.includes("permission denied")||r.includes("not allowed")}async function l(e){return s.from("profiles").select("id,full_name,role,school_id,phone,avatar_url").eq("id",e).maybeSingle()}async function n(){let e,{data:{user:r},error:t}=await s.auth.getUser();if(t)throw t;if(!r)return{user:null,profile:null};let n=await l(r.id);if(n.error){if(a(n.error.message))return{user:r,profile:null};throw n.error}if(n.data)return{user:r,profile:n.data};let{error:i}=await s.from("profiles").upsert([{id:r.id,full_name:"string"==typeof(e=r.user_metadata?.full_name)&&e.trim()?e.trim():r.email&&r.email.split("@")[0]||""}],{onConflict:"id"});if(i){if(a(i.message))return{user:r,profile:null};throw i}let o=await l(r.id);if(o.error){if(a(o.error.message))return{user:r,profile:null};throw o.error}return{user:r,profile:o.data??null}}},7236:(e,r,t)=>{"use strict";t.d(r,{U:()=>a});var s=t(6622);function a(){return(0,s.createBrowserClient)("https://zuppzhysrgmioyozrltp.supabase.co","sb_publishable_GQkKFgomb7ThK_H_csmdoQ_CYQOschE")}},7557:(e,r,t)=>{Promise.resolve().then(t.bind(t,2309))},8992:(e,r,t)=>{"use strict";t.d(r,{A:()=>l});var s=t(5155),a=t(1337);function l({className:e,...r}){return(0,s.jsx)("div",{className:(0,a.cn)("rounded-3xl bg-white p-6 shadow-card",e),...r})}}},e=>{e.O(0,[143,500,409,441,794,358],()=>e(e.s=7557)),_N_E=e.O()}]);