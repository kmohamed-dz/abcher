(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[289],{1878:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(2806).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},1914:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(2806).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2806:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var l=r(2115);let s=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,l.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:n="",children:o,iconNode:c,...d},h)=>(0,l.createElement)("svg",{ref:h,...i,width:t,height:t,stroke:e,strokeWidth:a?24*Number(r)/Number(t):r,className:s("lucide",n),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,t])=>(0,l.createElement)(e,t)),...Array.isArray(o)?o:[o]])),o=(e,t)=>{let r=(0,l.forwardRef)(({className:r,...i},o)=>(0,l.createElement)(n,{ref:o,iconNode:t,className:s(`lucide-${a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...i}));return r.displayName=a(e),r}},3210:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(2806).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7236:(e,t,r)=>{"use strict";r.d(t,{U:()=>s});var l=r(6622);function s(){return(0,l.createBrowserClient)("https://zuppzhysrgmioyozrltp.supabase.co","sb_publishable_GQkKFgomb7ThK_H_csmdoQ_CYQOschE")}},8270:(e,t,r)=>{Promise.resolve().then(r.bind(r,9485))},9485:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var l=r(5155),s=r(2115),a=r(1914),i=r(1878),n=r(8434),o=r(3210),c=r(7236);let d=(0,c.U)(),h={full_name:"",specialization:"",phone:""};function m({isOpen:e,onClose:t,onSuccess:r,schoolId:a,teacher:i}){let[c,m]=(0,s.useState)(h),[u,p]=(0,s.useState)({}),[x,y]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{e&&(i?m({full_name:i.full_name,specialization:i.specialization,phone:i.phone??""}):m(h),p({}))},[e,i]),!e)return null;let f=(e,t)=>{m(r=>({...r,[e]:t}))},b=async()=>{let e;if(e={},c.full_name.trim()||(e.full_name="يرجى إدخال الاسم الكامل."),c.specialization.trim()||(e.specialization="يرجى إدخال التخصص."),p(e),0!==Object.keys(e).length)return void n.Ay.error("تحقق من الحقول المطلوبة.");if(!a)return void n.Ay.error("تعذر معرفة المدرسة الحالية.");y(!0);try{if(i){let{error:e}=await d.from("teachers").update({full_name:c.full_name.trim(),specialization:c.specialization.trim(),phone:c.phone.trim()||null}).eq("id",i.id).eq("school_id",a);if(e)throw e;n.Ay.success("تم تحديث بيانات المعلم.")}else{let{error:e}=await d.from("teachers").insert([{school_id:a,full_name:c.full_name.trim(),specialization:c.specialization.trim(),phone:c.phone.trim()||null}]);if(e)throw e;n.Ay.success("تمت إضافة المعلم بنجاح.")}r()}catch(t){let e=t instanceof Error?t.message:"تعذر حفظ بيانات المعلم.";n.Ay.error(e)}finally{y(!1)}};return(0,l.jsx)("div",{dir:"rtl",className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",onClick:e=>{e.target===e.currentTarget&&t()},role:"presentation",children:(0,l.jsxs)("div",{className:"w-full max-w-lg rounded-xl bg-white p-6 shadow-md",children:[(0,l.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-primary-700",children:i?"تعديل معلم":"إضافة معلم"}),(0,l.jsx)("button",{type:"button",onClick:t,className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-gray-200 text-gray-600 hover:bg-gray-100","aria-label":"إغلاق",children:(0,l.jsx)(o.A,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"teacher-full-name",className:"mb-1 block text-sm font-semibold text-gray-700",children:"الاسم الكامل"}),(0,l.jsx)("input",{id:"teacher-full-name",value:c.full_name,onChange:e=>f("full_name",e.target.value),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring",placeholder:"أدخل الاسم الكامل"}),u.full_name?(0,l.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.full_name}):null]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"teacher-specialization",className:"mb-1 block text-sm font-semibold text-gray-700",children:"التخصص"}),(0,l.jsx)("input",{id:"teacher-specialization",value:c.specialization,onChange:e=>f("specialization",e.target.value),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring",placeholder:"مثال: تجويد، فقه، لغة عربية"}),u.specialization?(0,l.jsx)("p",{className:"mt-1 text-sm text-red-600",children:u.specialization}):null]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"teacher-phone",className:"mb-1 block text-sm font-semibold text-gray-700",children:"رقم الهاتف (اختياري)"}),(0,l.jsx)("input",{id:"teacher-phone",value:c.phone,onChange:e=>f("phone",e.target.value),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring",placeholder:"أدخل رقم الهاتف"})]})]}),(0,l.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:t,disabled:x,className:"min-h-[44px] rounded-lg border border-gray-200 px-4 py-2 text-gray-700 hover:bg-gray-100",children:"إلغاء"}),(0,l.jsx)("button",{type:"button",onClick:()=>{b()},disabled:x,className:"min-h-[44px] rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:x?"جارٍ الحفظ...":"حفظ"})]})]})})}let u=(0,c.U)();function p(){let[e,t]=(0,s.useState)([]),[r,o]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[h,p]=(0,s.useState)(!0),[x,y]=(0,s.useState)(""),[f,b]=(0,s.useState)(!1),[g,j]=(0,s.useState)(null),w="school_admin"===c||"teacher"===c,N=(0,s.useCallback)(async()=>{p(!0);try{let{data:{user:e}}=await u.auth.getUser();if(!e)throw Error("يرجى تسجيل الدخول أولًا.");let{data:r,error:l}=await u.from("profiles").select("school_id, role").eq("id",e.id).single();if(l)throw l;if(d(r?.role??null),!r?.school_id){o(null),t([]);return}o(r.school_id);let{data:s,error:a}=await u.from("teachers").select("id,school_id,full_name,specialization,phone,created_at").eq("school_id",r.school_id).order("created_at",{ascending:!1});if(a)throw a;t(s??[])}catch(t){let e=t instanceof Error?t.message:"تعذر تحميل المعلمين.";n.Ay.error(e)}finally{p(!1)}},[]);(0,s.useEffect)(()=>{N()},[N]);let v=(0,s.useMemo)(()=>{let t=x.trim().toLowerCase();return t?e.filter(e=>e.full_name.toLowerCase().includes(t)||e.specialization.toLowerCase().includes(t)||(e.phone??"").toLowerCase().includes(t)):e},[x,e]),_=async e=>{if(r&&w&&window.confirm(`هل تريد حذف المعلم ${e.full_name}؟`))try{let{error:t}=await u.from("teachers").delete().eq("id",e.id).eq("school_id",r);if(t)throw t;n.Ay.success("تم حذف المعلم بنجاح."),await N()}catch(t){let e=t instanceof Error?t.message:"تعذر حذف المعلم.";n.Ay.error(e)}};return h?(0,l.jsx)("section",{dir:"rtl",className:"flex min-h-[65vh] items-center justify-center",children:(0,l.jsx)("div",{className:"h-11 w-11 animate-spin rounded-full border-4 border-primary-100 border-t-primary-600"})}):r?(0,l.jsxs)("section",{dir:"rtl",className:"space-y-5",children:[(0,l.jsx)("header",{className:"rounded-xl bg-white p-6 shadow-md",children:(0,l.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-primary-700",children:"إدارة المعلمين"}),(0,l.jsx)("p",{className:"mt-2 text-gray-600",children:"إضافة وتعديل وحذف بيانات المعلمين."})]}),w?(0,l.jsxs)("button",{type:"button",onClick:()=>{j(null),b(!0)},className:"inline-flex min-h-[44px] items-center justify-center gap-2 rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:[(0,l.jsx)(a.A,{className:"h-4 w-4"}),"إضافة معلم"]}):null]})}),(0,l.jsxs)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,l.jsx)("label",{htmlFor:"teacher-search",className:"mb-2 block text-sm font-semibold text-gray-700",children:"البحث"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(i.A,{className:"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),(0,l.jsx)("input",{id:"teacher-search",value:x,onChange:e=>y(e.target.value),placeholder:"ابحث بالاسم أو التخصص أو الهاتف",className:"w-full rounded-lg border border-gray-200 py-3 pr-10 pl-3 text-[16px] outline-none ring-primary-200 focus:ring"})]})]}),0===v.length?(0,l.jsxs)("section",{className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,l.jsx)("p",{className:"mb-4 text-gray-600",children:"لا توجد بيانات معلمين مطابقة."}),w?(0,l.jsx)("button",{type:"button",onClick:()=>{j(null),b(!0)},className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"إضافة أول معلم"}):null]}):(0,l.jsx)("section",{className:"overflow-hidden rounded-xl bg-white shadow-md",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full text-right",children:[(0,l.jsx)("thead",{className:"bg-primary-50 text-sm text-primary-700",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-4 py-3",children:"الاسم"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"التخصص"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"الهاتف"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"الإجراءات"})]})}),(0,l.jsx)("tbody",{children:v.map(e=>(0,l.jsxs)("tr",{className:"border-t border-gray-100",children:[(0,l.jsx)("td",{className:"px-4 py-3 font-semibold text-gray-900",children:e.full_name}),(0,l.jsx)("td",{className:"px-4 py-3 text-gray-700",children:e.specialization}),(0,l.jsx)("td",{className:"px-4 py-3 text-gray-700",children:e.phone||"-"}),(0,l.jsx)("td",{className:"px-4 py-3",children:w?(0,l.jsxs)("div",{className:"flex flex-wrap justify-end gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{j(e),b(!0)},className:"min-h-[44px] rounded-lg bg-yellow-500 px-3 py-2 text-sm text-white",children:"تعديل"}),(0,l.jsx)("button",{type:"button",onClick:()=>{_(e)},className:"min-h-[44px] rounded-lg bg-red-600 px-3 py-2 text-sm text-white",children:"حذف"})]}):(0,l.jsx)("span",{className:"text-sm text-gray-500",children:"قراءة فقط"})})]},e.id))})]})})}),(0,l.jsx)(m,{isOpen:f,onClose:()=>b(!1),onSuccess:()=>{b(!1),N()},schoolId:r,teacher:g})]}):(0,l.jsxs)("section",{dir:"rtl",className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,l.jsx)("h1",{className:"mb-3 text-2xl font-bold text-primary-700",children:"لم يتم ربط الحساب بمدرسة"}),(0,l.jsx)("p",{className:"mb-6 text-gray-600",children:"أكمل إعداد المدرسة لإدارة قائمة المعلمين."}),(0,l.jsx)("a",{href:"/onboarding",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"إكمال الإعداد"})]})}}},e=>{e.O(0,[143,441,794,358],()=>e(e.s=8270)),_N_E=e.O()}]);