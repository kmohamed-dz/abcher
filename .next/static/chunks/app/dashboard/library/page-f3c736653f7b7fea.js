(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[381],{1337:(e,r,t)=>{"use strict";t.d(r,{A_:()=>c,Yq:()=>n,cn:()=>s,r6:()=>o});var a=t(9722),l=t(622);function s(...e){return(0,l.QP)((0,a.$)(e))}function i(e){return e instanceof Date?e:new Date(e)}function n(e){let r=i(e);return Number.isNaN(r.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric"}).format(r)}function o(e){let r=i(e);return Number.isNaN(r.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(r)}let c=["المبتدئ","جزء عم","جزء تبارك","ثلث القرآن","نصف القرآن","ثلاثة أرباع القرآن","الحفظ الكامل"]},2024:(e,r,t)=>{Promise.resolve().then(t.bind(t,4609))},2806:(e,r,t)=>{"use strict";t.d(r,{A:()=>o});var a=t(2115);let l=(...e)=>e.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim(),s=e=>{let r=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,t)=>t?t.toUpperCase():r.toLowerCase());return r.charAt(0).toUpperCase()+r.slice(1)};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,a.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:n="",children:o,iconNode:c,...d},m)=>(0,a.createElement)("svg",{ref:m,...i,width:r,height:r,stroke:e,strokeWidth:s?24*Number(t)/Number(r):t,className:l("lucide",n),...!o&&!(e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0;return!1})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,r])=>(0,a.createElement)(e,r)),...Array.isArray(o)?o:[o]])),o=(e,r)=>{let t=(0,a.forwardRef)(({className:t,...i},o)=>(0,a.createElement)(n,{ref:o,iconNode:r,className:l(`lucide-${s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,t),...i}));return t.displayName=s(e),t}},4609:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var a=t(5155),l=t(8500),s=t.n(l),i=t(2115);let n=(0,t(2806).A)("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);var o=t(8434),c=t(7236),d=t(1337);let m=(0,c.U)();function u(){let[e,r]=(0,i.useState)(!0),[t,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)(null),[h,p]=(0,i.useState)(null),[x,f]=(0,i.useState)("مستخدم"),[g,y]=(0,i.useState)([]),[b,w]=(0,i.useState)(""),[N,j]=(0,i.useState)(d.A_[0]),_="school_admin"===h||"teacher"===h,v=(0,i.useCallback)(async()=>{r(!0);try{let{data:{user:e}}=await m.auth.getUser();if(!e)throw Error("يرجى تسجيل الدخول أولًا.");let{data:r,error:t}=await m.from("profiles").select("school_id, role, full_name").eq("id",e.id).single();if(t)throw t;if(p(r?.role??null),f(r?.full_name||"مستخدم"),!r?.school_id){u(null),y([]);return}u(r.school_id);let{data:a,error:l}=await m.from("library").select("id,school_id,title,level,file_name,file_type,file_path,public_url,created_at").eq("school_id",r.school_id).order("created_at",{ascending:!1});if(l)throw l;y(a??[])}catch(r){let e=r instanceof Error?r.message:"تعذر تحميل مكتبة الملفات.";o.Ay.error(e)}finally{r(!1)}},[]);(0,i.useEffect)(()=>{v()},[v]);let k=async e=>{let r=e.target.files?.[0];if(!r)return;if(!_){o.Ay.error("ليس لديك صلاحية رفع الملفات."),e.target.value="";return}if(!c){o.Ay.error("تعذر معرفة المدرسة الحالية."),e.target.value="";return}let t=r.name.includes(".")&&r.name.split(".").pop()?.toLowerCase()||"file";if(!["pdf","mp3","wav","ogg","mp4","mov","webm"].includes(t)){o.Ay.error("نوع الملف غير مدعوم. المسموح: PDF / Audio / Video"),e.target.value="";return}let a=b.trim()||r.name;l(!0);try{let e=`${c}/${Date.now()}-${r.name}`,{error:l}=await m.storage.from("library").upload(e,r,{upsert:!1});if(l)throw l;let{data:s}=m.storage.from("library").getPublicUrl(e),{error:i}=await m.from("library").insert([{school_id:c,title:a,level:N,file_name:r.name,file_type:t,file_path:e,public_url:s.publicUrl,uploaded_by_name:x}]);if(i)throw i;w(""),o.Ay.success("تم رفع الملف بنجاح."),await v()}catch(r){let e=r instanceof Error?r.message:"تعذر رفع الملف.";o.Ay.error(e)}finally{l(!1),e.target.value=""}};return e?(0,a.jsx)("section",{dir:"rtl",className:"flex min-h-[65vh] items-center justify-center",children:(0,a.jsx)("div",{className:"h-11 w-11 animate-spin rounded-full border-4 border-primary-100 border-t-primary-600"})}):c?(0,a.jsxs)("section",{dir:"rtl",className:"space-y-5",children:[(0,a.jsxs)("header",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-primary-700",children:"المكتبة التعليمية"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"رفع ملفات PDF والصوت والفيديو وتصنيفها حسب المستوى."})]}),_?(0,a.jsx)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"resource-title",className:"mb-1 block text-sm font-semibold text-gray-700",children:"عنوان المورد"}),(0,a.jsx)("input",{id:"resource-title",value:b,onChange:e=>w(e.target.value),placeholder:"مثال: مراجعة سورة الملك",className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"resource-level",className:"mb-1 block text-sm font-semibold text-gray-700",children:"المستوى"}),(0,a.jsx)("select",{id:"resource-level",value:N,onChange:e=>j(e.target.value),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring",children:d.A_.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsxs)("label",{className:"inline-flex min-h-[44px] w-full cursor-pointer items-center justify-center gap-2 rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:[(0,a.jsx)(n,{className:"h-4 w-4"}),t?"جارٍ الرفع...":"رفع ملف",(0,a.jsx)("input",{type:"file",className:"hidden",onChange:k,disabled:t})]})})]})}):(0,a.jsx)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:(0,a.jsx)("p",{className:"text-gray-600",children:"يمكنك تصفح وتحميل الملفات فقط. الرفع متاح للمعلم/الإدارة."})}),0===g.length?(0,a.jsxs)("section",{className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,a.jsx)("p",{className:"mb-4 text-gray-600",children:"لا توجد ملفات متاحة حاليًا."}),_?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"ابدأ برفع أول مورد تعليمي."}):(0,a.jsx)(s(),{href:"/dashboard/messages",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"تواصل مع الإدارة"})]}):(0,a.jsx)("section",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:g.map(e=>(0,a.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,a.jsxs)("div",{className:"mb-2 flex items-start justify-between gap-2",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:e.title}),(0,a.jsx)("span",{className:"rounded-full bg-primary-100 px-3 py-1 text-xs font-semibold text-primary-700",children:e.level})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["اسم الملف: ",e.file_name]}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-600",children:["النوع: ",e.file_type.toUpperCase()]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:(0,d.r6)(e.created_at)}),(0,a.jsx)("div",{className:"mt-4 flex justify-end",children:(0,a.jsx)("a",{href:e.public_url,target:"_blank",rel:"noreferrer",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"تنزيل / فتح"})})]},e.id))})]}):(0,a.jsxs)("section",{dir:"rtl",className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,a.jsx)("h1",{className:"mb-3 text-2xl font-bold text-primary-700",children:"لا توجد مدرسة مرتبطة"}),(0,a.jsx)("p",{className:"mb-6 text-gray-600",children:"أكمل الإعداد حتى تتمكن من استخدام المكتبة."}),(0,a.jsx)(s(),{href:"/onboarding",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"إكمال الإعداد"})]})}},7236:(e,r,t)=>{"use strict";t.d(r,{U:()=>l});var a=t(6622);function l(){return(0,a.createBrowserClient)("https://zuppzhysrgmioyozrltp.supabase.co","sb_publishable_GQkKFgomb7ThK_H_csmdoQ_CYQOschE")}}},e=>{e.O(0,[143,500,409,441,794,358],()=>e(e.s=2024)),_N_E=e.O()}]);