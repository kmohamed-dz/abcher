(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[589],{352:(e,t,r)=>{Promise.resolve().then(r.bind(r,6508))},2806:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var s=r(2115);let a=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),l=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,s.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:l,className:n="",children:d,iconNode:o,...c},m)=>(0,s.createElement)("svg",{ref:m,...i,width:t,height:t,stroke:e,strokeWidth:l?24*Number(r)/Number(t):r,className:a("lucide",n),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1})(c)&&{"aria-hidden":"true"},...c},[...o.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(d)?d:[d]])),d=(e,t)=>{let r=(0,s.forwardRef)(({className:r,...i},d)=>(0,s.createElement)(n,{ref:d,iconNode:t,className:a(`lucide-${l(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...i}));return r.displayName=l(e),r}},6508:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(5155),a=r(2115),l=r(8500),i=r.n(l);let n=(0,r(2806).A)("file-down",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);var d=r(8434);let o=(0,r(7236).U)();function c(){let[e,t]=(0,a.useState)(!0),[r,l]=(0,a.useState)(null),[c,m]=(0,a.useState)(()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),1).toISOString().slice(0,10)}),[h,x]=(0,a.useState)(()=>new Date().toISOString().slice(0,10)),[u,p]=(0,a.useState)(0),[g,b]=(0,a.useState)(0),[f,y]=(0,a.useState)([]),w=(0,a.useCallback)(async()=>{t(!0);try{let{data:{user:e}}=await o.auth.getUser();if(!e)throw Error("يرجى تسجيل الدخول أولًا.");let{data:t,error:r}=await o.from("profiles").select("school_id").eq("id",e.id).single();if(r)throw r;if(!t?.school_id){l(null),p(0),b(0),y([]);return}let s=t.school_id;l(s);let a=await o.from("students").select("id, full_name").eq("school_id",s);if(a.error)throw a.error;let i=a.data??[];p(i.length);let n=o.from("attendance").select("student_id,status,date").eq("school_id",s).gte("date",c).lte("date",h),d=await n;if(d.error)throw d.error;let m=d.data??[],x=new Date(h),u=new Date(x);u.setDate(x.getDate()-6);let g=u.toISOString().slice(0,10),f=m.filter(e=>e.date>=g&&e.date<=h),w=f.filter(e=>["present","late","excused"].includes(e.status)).length,j=f.length;b(0===j?0:Math.round(w/j*100));let N=new Map;m.forEach(e=>{"absent"===e.status&&N.set(e.student_id,(N.get(e.student_id)??0)+1)});let _=new Map(i.map(e=>[e.id,e.full_name])),v=Array.from(N.entries()).map(([e,t])=>({student_id:e,student_name:_.get(e)??"طالب غير معروف",absent_count:t})).sort((e,t)=>t.absent_count-e.absent_count).slice(0,5);y(v)}catch(t){let e=t instanceof Error?t.message:"تعذر تحميل التقارير.";d.Ay.error(e)}finally{t(!1)}},[c,h]);(0,a.useEffect)(()=>{w()},[w]);let j=(0,a.useMemo)(()=>u>0||f.length>0,[u,f.length]);return e?(0,s.jsx)("section",{dir:"rtl",className:"flex min-h-[65vh] items-center justify-center",children:(0,s.jsx)("div",{className:"h-11 w-11 animate-spin rounded-full border-4 border-primary-100 border-t-primary-600"})}):r?(0,s.jsxs)("section",{dir:"rtl",className:"space-y-5",children:[(0,s.jsxs)("header",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-primary-700",children:"التقارير"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"مؤشرات الأداء والحضور خلال الفترة المحددة."})]}),(0,s.jsx)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"from-date",className:"mb-1 block text-sm font-semibold text-gray-700",children:"من تاريخ"}),(0,s.jsx)("input",{id:"from-date",type:"date",value:c,onChange:e=>m(e.target.value),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"to-date",className:"mb-1 block text-sm font-semibold text-gray-700",children:"إلى تاريخ"}),(0,s.jsx)("input",{id:"to-date",type:"date",value:h,onChange:e=>x(e.target.value),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring"})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsx)("button",{type:"button",onClick:()=>{w()},className:"w-full min-h-[44px] rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"تحديث"})}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsxs)("button",{type:"button",onClick:()=>d.Ay.success("زر تصدير PDF جاهز، أضف خدمة التصدير لاحقًا."),className:"inline-flex min-h-[44px] w-full items-center justify-center gap-2 rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:[(0,s.jsx)(n,{className:"h-4 w-4"}),"تصدير PDF"]})})]})}),(0,s.jsxs)("section",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,s.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"إجمالي الطلبة"}),(0,s.jsx)("p",{className:"mt-2 text-3xl font-extrabold text-gray-900",children:u})]}),(0,s.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"معدل الحضور الأسبوعي"}),(0,s.jsxs)("p",{className:"mt-2 text-3xl font-extrabold text-primary-700",children:[g,"%"]})]})]}),(0,s.jsxs)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("h2",{className:"mb-4 text-xl font-bold text-primary-700",children:"أكثر 5 طلبة غيابًا"}),j&&0!==f.length?(0,s.jsx)("ul",{className:"space-y-2",children:f.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-gray-100 bg-beige-50 p-3",children:[(0,s.jsxs)("p",{className:"font-semibold text-gray-900",children:[t+1,". ",e.student_name]}),(0,s.jsxs)("p",{className:"font-bold text-red-600",children:[e.absent_count," غياب"]})]},e.student_id))}):(0,s.jsxs)("div",{className:"rounded-lg border border-dashed border-primary-200 bg-primary-50 p-6 text-center",children:[(0,s.jsx)("p",{className:"mb-4 text-gray-600",children:"لا توجد بيانات غياب كافية في الفترة المحددة."}),(0,s.jsx)(i(),{href:"/dashboard/attendance",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"تسجيل حضور جديد"})]})]})]}):(0,s.jsxs)("section",{dir:"rtl",className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,s.jsx)("h1",{className:"mb-3 text-2xl font-bold text-primary-700",children:"لا توجد مدرسة مرتبطة"}),(0,s.jsx)("p",{className:"mb-6 text-gray-600",children:"أكمل الإعداد لعرض التقارير."}),(0,s.jsx)(i(),{href:"/onboarding",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"إكمال الإعداد"})]})}},7236:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var s=r(6622);function a(){return(0,s.createBrowserClient)("https://zuppzhysrgmioyozrltp.supabase.co","sb_publishable_GQkKFgomb7ThK_H_csmdoQ_CYQOschE")}}},e=>{e.O(0,[143,500,441,794,358],()=>e(e.s=352)),_N_E=e.O()}]);