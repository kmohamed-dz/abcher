(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[904],{1337:(e,t,r)=>{"use strict";r.d(t,{A_:()=>o,Yq:()=>i,cn:()=>l,r6:()=>d});var s=r(9722),a=r(622);function l(...e){return(0,a.QP)((0,s.$)(e))}function n(e){return e instanceof Date?e:new Date(e)}function i(e){let t=n(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric"}).format(t)}function d(e){let t=n(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}let o=["المبتدئ","جزء عم","جزء تبارك","ثلث القرآن","نصف القرآن","ثلاثة أرباع القرآن","الحفظ الكامل"]},3321:(e,t,r)=>{"use strict";var s=r(4645);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},3831:(e,t,r)=>{Promise.resolve().then(r.bind(r,9373))},7236:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var s=r(6622);function a(){return(0,s.createBrowserClient)("https://zuppzhysrgmioyozrltp.supabase.co","sb_publishable_GQkKFgomb7ThK_H_csmdoQ_CYQOschE")}},9373:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var s=r(5155),a=r(8500),l=r.n(a),n=r(2115),i=r(3321),d=r(8434),o=r(7236),c=r(1337);let m=(0,o.U)();function h(){let e=(0,i.useParams)(),t=e?.id,[r,a]=(0,n.useState)(!0),[o,h]=(0,n.useState)(null),[x,u]=(0,n.useState)(null),[p,g]=(0,n.useState)("المعلم"),[f,b]=(0,n.useState)(null),[y,_]=(0,n.useState)([]),[N,j]=(0,n.useState)([]),[w,v]=(0,n.useState)(0),[q,S]=(0,n.useState)([]),[k,C]=(0,n.useState)(""),[D,E]=(0,n.useState)(!1),P="school_admin"===x||"teacher"===x,A=(0,n.useCallback)(async()=>{if(!t)return void a(!1);a(!0);try{let{data:{user:e}}=await m.auth.getUser();if(!e)throw Error("يرجى تسجيل الدخول أولًا.");let{data:r,error:s}=await m.from("profiles").select("school_id, role, full_name").eq("id",e.id).single();if(s)throw s;if(u(r?.role??null),g(r?.full_name||"المعلم"),!r?.school_id){h(null),b(null);return}h(r.school_id);let{data:a,error:l}=await m.from("students").select("id,school_id,full_name,level,parent_phone,created_at").eq("id",t).eq("school_id",r.school_id).single();if(l)throw l;b(a);let n=new Date,i=new Date(n.getFullYear(),n.getMonth(),1).toISOString().slice(0,10),d=new Date(n.getFullYear(),n.getMonth()+1,0).toISOString().slice(0,10),[o,c,x,p,f]=await Promise.all([m.from("attendance").select("date,status").eq("school_id",r.school_id).eq("student_id",t).gte("date",i).lte("date",d),m.from("homework").select("id").eq("school_id",r.school_id).eq("level",a.level),m.from("homework_submissions").select("homework_id,completed").eq("school_id",r.school_id).eq("student_id",t),m.from("teacher_notes").select("id,note,created_at,teacher_name").eq("school_id",r.school_id).eq("student_id",t).order("created_at",{ascending:!1}),m.from("results").select("id,exam_id,score,created_at").eq("school_id",r.school_id).eq("student_id",t).order("created_at",{ascending:!1})]);if(o.error||c.error||x.error||p.error||f.error)throw o.error||c.error||x.error||p.error||f.error;let y=o.data??[];_(y);let N=c.data??[],w=(x.data??[]).filter(e=>e.completed),q=0===N.length?0:Math.round(w.length/N.length*100);v(q),S(p.data??[]);let k=f.data??[];if(k.length>0){let e=Array.from(new Set(k.map(e=>e.exam_id))),{data:t,error:s}=await m.from("exams").select("id,title,exam_date,max_score").eq("school_id",r.school_id).in("id",e);if(s)throw s;let a=new Map;(t??[]).forEach(e=>{a.set(e.id,e)});let l=k.map(e=>{let t=a.get(e.exam_id);return t?{exam_title:t.title,exam_date:t.exam_date,score:e.score,max_score:t.max_score}:null}).filter(e=>null!==e);j(l)}else j([])}catch(t){let e=t instanceof Error?t.message:"تعذر تحميل ملف الطالب.";d.Ay.error(e)}finally{a(!1)}},[t]);(0,n.useEffect)(()=>{A()},[A]);let M=(0,n.useMemo)(()=>{let e,t,r;return t=(e=new Date).getFullYear(),Array.from({length:new Date(t,(r=e.getMonth())+1,0).getDate()},(e,s)=>new Date(t,r,s+1).toISOString().slice(0,10))},[]),Y=(0,n.useMemo)(()=>{let e=new Map;return y.forEach(t=>e.set(t.date,t.status)),e},[y]),F=async()=>{if(!o||!t||!P)return void d.Ay.error("ليس لديك صلاحية إضافة ملاحظة.");if(!k.trim())return void d.Ay.error("اكتب ملاحظة قبل الحفظ.");E(!0);try{let{error:e}=await m.from("teacher_notes").insert([{school_id:o,student_id:t,note:k.trim(),teacher_name:p}]);if(e)throw e;d.Ay.success("تم حفظ الملاحظة."),C(""),await A()}catch(t){let e=t instanceof Error?t.message:"تعذر حفظ الملاحظة.";d.Ay.error(e)}finally{E(!1)}};return r?(0,s.jsx)("section",{dir:"rtl",className:"flex min-h-[65vh] items-center justify-center",children:(0,s.jsx)("div",{className:"h-11 w-11 animate-spin rounded-full border-4 border-primary-100 border-t-primary-600"})}):o?f?(0,s.jsxs)("section",{dir:"rtl",className:"space-y-5",children:[(0,s.jsxs)("header",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-primary-700",children:"ملف الطالب"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"متابعة الحضور والواجبات والنتائج والملاحظات."})]}),(0,s.jsxs)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:f.full_name}),(0,s.jsxs)("div",{className:"mt-3 grid grid-cols-1 gap-2 text-sm text-gray-600 md:grid-cols-3",children:[(0,s.jsxs)("p",{children:["المستوى: ",f.level]}),(0,s.jsxs)("p",{children:["هاتف ولي الأمر: ",f.parent_phone||"-"]}),(0,s.jsxs)("p",{children:["تاريخ التسجيل: ",(0,c.Yq)(f.created_at)]})]})]}),(0,s.jsxs)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("h2",{className:"mb-3 text-lg font-bold text-primary-700",children:"خريطة الحضور الشهرية"}),(0,s.jsxs)("div",{className:"mb-3 flex flex-wrap gap-3 text-xs text-gray-600",children:[(0,s.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded",style:{backgroundColor:"#16a34a"}})," حاضر"]}),(0,s.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded",style:{backgroundColor:"#f59e0b"}})," متأخر"]}),(0,s.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded",style:{backgroundColor:"#0891b2"}})," بعذر"]}),(0,s.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded",style:{backgroundColor:"#dc2626"}})," غائب"]}),(0,s.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded",style:{backgroundColor:"#e5e7eb"}})," غير مسجل"]})]}),(0,s.jsx)("div",{className:"grid grid-cols-7 gap-2 md:grid-cols-10 lg:grid-cols-14",children:M.map(e=>{let t=Y.get(e);return(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsx)("div",{className:"h-6 w-6 rounded",style:{backgroundColor:"present"===t?"#16a34a":"late"===t?"#f59e0b":"excused"===t?"#0891b2":"absent"===t?"#dc2626":"#e5e7eb"},title:e}),(0,s.jsx)("span",{className:"text-[10px] text-gray-500",children:e.slice(8,10)})]},e)})})]}),(0,s.jsxs)("section",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[(0,s.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("h2",{className:"mb-3 text-lg font-bold text-primary-700",children:"معدل إنجاز الواجبات"}),(0,s.jsxs)("p",{className:"text-4xl font-extrabold text-primary-700",children:[w,"%"]}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"نسبة الواجبات المكتملة مقارنة بالواجبات المخصصة للمستوى."})]}),(0,s.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("h2",{className:"mb-3 text-lg font-bold text-primary-700",children:"سجل النتائج"}),0===N.length?(0,s.jsxs)("div",{className:"rounded-lg border border-dashed border-primary-200 bg-primary-50 p-4 text-center",children:[(0,s.jsx)("p",{className:"mb-3 text-sm text-gray-600",children:"لا توجد نتائج مسجلة بعد."}),(0,s.jsx)(l(),{href:"/dashboard/results",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"إدارة النتائج"})]}):(0,s.jsx)("ul",{className:"space-y-2",children:N.map((e,t)=>(0,s.jsxs)("li",{className:"rounded-lg bg-beige-50 p-3",children:[(0,s.jsx)("p",{className:"font-semibold text-gray-900",children:e.exam_title}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["التاريخ: ",(0,c.Yq)(e.exam_date)]}),(0,s.jsxs)("p",{className:"text-sm text-primary-700",children:["الدرجة: ",e.score," / ",e.max_score]})]},`${e.exam_title}-${t}`))})]})]}),(0,s.jsxs)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,s.jsx)("h2",{className:"mb-3 text-lg font-bold text-primary-700",children:"ملاحظات المعلمين"}),P?(0,s.jsxs)("div",{className:"mb-4 space-y-2",children:[(0,s.jsx)("textarea",{value:k,onChange:e=>C(e.target.value),rows:3,className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring",placeholder:"أضف ملاحظة تربوية عن الطالب"}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"button",disabled:D,onClick:()=>{F()},className:"min-h-[44px] rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700 disabled:opacity-60",children:D?"جارٍ الحفظ...":"حفظ الملاحظة"})})]}):null,0===q.length?(0,s.jsx)("div",{className:"rounded-lg border border-dashed border-primary-200 bg-primary-50 p-4 text-center text-sm text-gray-600",children:"لا توجد ملاحظات مسجلة."}):(0,s.jsx)("ul",{className:"space-y-2",children:q.map(e=>(0,s.jsxs)("li",{className:"rounded-lg bg-beige-50 p-3",children:[(0,s.jsx)("p",{className:"text-gray-800",children:e.note}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:[e.teacher_name," - ",(0,c.Yq)(e.created_at)]})]},e.id))})]})]}):(0,s.jsxs)("section",{dir:"rtl",className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,s.jsx)("h1",{className:"mb-3 text-2xl font-bold text-primary-700",children:"لم يتم العثور على الطالب"}),(0,s.jsx)("p",{className:"mb-6 text-gray-600",children:"تحقق من الرابط أو عد إلى قائمة الطلبة."}),(0,s.jsx)(l(),{href:"/dashboard/students",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"العودة إلى الطلبة"})]}):(0,s.jsxs)("section",{dir:"rtl",className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,s.jsx)("h1",{className:"mb-3 text-2xl font-bold text-primary-700",children:"لا توجد مدرسة مرتبطة"}),(0,s.jsx)("p",{className:"mb-6 text-gray-600",children:"أكمل الإعداد للوصول إلى ملفات الطلبة."}),(0,s.jsx)(l(),{href:"/onboarding",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"إكمال الإعداد"})]})}}},e=>{e.O(0,[143,500,409,441,794,358],()=>e(e.s=3831)),_N_E=e.O()}]);