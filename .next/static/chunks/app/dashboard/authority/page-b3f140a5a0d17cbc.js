(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[455],{2234:(e,s,a)=>{Promise.resolve().then(a.bind(a,6518))},6518:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>n});var t=a(5155),r=a(8500),l=a.n(r),i=a(2115),c=a(8434);let d=(0,a(7236).U)();function n(){let[e,s]=(0,i.useState)(!0),[a,r]=(0,i.useState)(!1),[n,o]=(0,i.useState)({schools_per_wilaya:[],students_per_wilaya:[],total_teachers:0,avg_attendance_rate:0}),h=(0,i.useCallback)(async()=>{s(!0);try{let{data:{user:e}}=await d.auth.getUser();if(!e)throw Error("يرجى تسجيل الدخول أولًا.");let{data:s,error:a}=await d.from("profiles").select("role").eq("id",e.id).single();if(a)throw a;if(s?.role!=="authority_admin")return void r(!1);r(!0);let{data:t,error:l}=await d.rpc("authority_dashboard_aggregates");if(l)throw l;o(t??{schools_per_wilaya:[],students_per_wilaya:[],total_teachers:0,avg_attendance_rate:0})}catch(s){let e=s instanceof Error?s.message:"تعذر تحميل لوحة الجهة الوصية.";c.Ay.error(e)}finally{s(!1)}},[]);return((0,i.useEffect)(()=>{h()},[h]),e)?(0,t.jsx)("section",{dir:"rtl",className:"flex min-h-[65vh] items-center justify-center",children:(0,t.jsx)("div",{className:"h-11 w-11 animate-spin rounded-full border-4 border-primary-100 border-t-primary-600"})}):a?(0,t.jsxs)("section",{dir:"rtl",className:"space-y-5",children:[(0,t.jsxs)("header",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-primary-700",children:"لوحة الجهة الوصية"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"إحصاءات مجمعة على مستوى جميع المدارس دون بيانات فردية."})]}),(0,t.jsxs)("section",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,t.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"إجمالي المعلمين"}),(0,t.jsx)("p",{className:"mt-2 text-3xl font-extrabold text-gray-900",children:n.total_teachers})]}),(0,t.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"متوسط الحضور العام"}),(0,t.jsxs)("p",{className:"mt-2 text-3xl font-extrabold text-primary-700",children:[n.avg_attendance_rate,"%"]})]})]}),(0,t.jsxs)("section",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[(0,t.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,t.jsx)("h2",{className:"mb-4 text-lg font-bold text-primary-700",children:"المدارس حسب الولاية"}),0===n.schools_per_wilaya.length?(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"لا توجد بيانات متاحة."}):(0,t.jsx)("ul",{className:"space-y-2",children:n.schools_per_wilaya.map(e=>(0,t.jsxs)("li",{className:"flex items-center justify-between rounded-lg bg-beige-50 px-3 py-2",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-900",children:e.wilaya}),(0,t.jsx)("span",{className:"text-primary-700",children:e.count})]},`school-${e.wilaya}`))})]}),(0,t.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,t.jsx)("h2",{className:"mb-4 text-lg font-bold text-primary-700",children:"الطلبة حسب الولاية"}),0===n.students_per_wilaya.length?(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"لا توجد بيانات متاحة."}):(0,t.jsx)("ul",{className:"space-y-2",children:n.students_per_wilaya.map(e=>(0,t.jsxs)("li",{className:"flex items-center justify-between rounded-lg bg-beige-50 px-3 py-2",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-900",children:e.wilaya}),(0,t.jsx)("span",{className:"text-primary-700",children:e.count})]},`student-${e.wilaya}`))})]})]})]}):(0,t.jsxs)("section",{dir:"rtl",className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,t.jsx)("h1",{className:"mb-3 text-2xl font-bold text-primary-700",children:"غير مصرح بالدخول"}),(0,t.jsx)("p",{className:"mb-6 text-gray-600",children:"هذه الصفحة متاحة فقط لدور الجهة الوصية."}),(0,t.jsx)(l(),{href:"/dashboard",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"العودة للوحة الرئيسية"})]})}},7236:(e,s,a)=>{"use strict";a.d(s,{U:()=>r});var t=a(6622);function r(){return(0,t.createBrowserClient)("https://zuppzhysrgmioyozrltp.supabase.co","sb_publishable_GQkKFgomb7ThK_H_csmdoQ_CYQOschE")}}},e=>{e.O(0,[143,500,441,794,358],()=>e(e.s=2234)),_N_E=e.O()}]);