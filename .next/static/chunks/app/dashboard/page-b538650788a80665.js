(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{1337:(e,t,r)=>{"use strict";r.d(t,{A_:()=>n,Yq:()=>c,cn:()=>i,r6:()=>d});var a=r(9722),s=r(622);function i(...e){return(0,s.QP)((0,a.$)(e))}function l(e){return e instanceof Date?e:new Date(e)}function c(e){let t=l(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric"}).format(t)}function d(e){let t=l(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}let n=["المبتدئ","جزء عم","جزء تبارك","ثلث القرآن","نصف القرآن","ثلاثة أرباع القرآن","الحفظ الكامل"]},2806:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var a=r(2115);let s=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),i=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:c="",children:d,iconNode:n,...o},m)=>(0,a.createElement)("svg",{ref:m,...l,width:t,height:t,stroke:e,strokeWidth:i?24*Number(r)/Number(t):r,className:s("lucide",c),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1})(o)&&{"aria-hidden":"true"},...o},[...n.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(d)?d:[d]])),d=(e,t)=>{let r=(0,a.forwardRef)(({className:r,...l},d)=>(0,a.createElement)(c,{ref:d,iconNode:t,className:s(`lucide-${i(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...l}));return r.displayName=i(e),r}},3053:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(2806).A)("clipboard-check",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]])},4461:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(5155),s=r(8500),i=r.n(s),l=r(2115),c=r(2806);let d=(0,c.A)("graduation-cap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);var n=r(7810),o=r(3053);let m=(0,c.A)("book-check",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}],["path",{d:"m9 9.5 2 2 4-4",key:"1dth82"}]]);var h=r(8434),u=r(7236),x=r(1337);let p=(0,u.U)();function g(){let[e,t]=(0,l.useState)(!0),[r,s]=(0,l.useState)(null),[c,u]=(0,l.useState)({students:0,teachers:0,attendanceRate:0,activeHomework:0}),[g,y]=(0,l.useState)([]),f=(0,l.useCallback)(async()=>{t(!0);try{let{data:{user:e},error:t}=await p.auth.getUser();if(t||!e)throw Error("تعذر التحقق من المستخدم.");let{data:r,error:a}=await p.from("profiles").select("school_id").eq("id",e.id).single();if(a)throw a;if(!r?.school_id){s(null),y([]),u({students:0,teachers:0,attendanceRate:0,activeHomework:0});return}let i=r.school_id;s(i);let l=new Date().toISOString().slice(0,10),[c,d,n,o,m,h]=await Promise.all([p.from("students").select("id",{count:"exact",head:!0}).eq("school_id",i),p.from("teachers").select("id",{count:"exact",head:!0}).eq("school_id",i),p.from("attendance").select("id",{count:"exact",head:!0}).eq("school_id",i).eq("date",l),p.from("attendance").select("id",{count:"exact",head:!0}).eq("school_id",i).eq("date",l).in("status",["present","late","excused"]),p.from("homework").select("id",{count:"exact",head:!0}).eq("school_id",i).or(`due_date.gte.${l},due_date.is.null`),p.from("notifications").select("id,title,message,created_at").eq("school_id",i).order("created_at",{ascending:!1}).limit(6)]);if(c.error||d.error||n.error||o.error||m.error||h.error)throw c.error||d.error||n.error||o.error||m.error||h.error;let x=n.count??0,g=o.count??0;u({students:c.count??0,teachers:d.count??0,activeHomework:m.count??0,attendanceRate:0===x?0:Math.round(g/x*100)});let f=(h.data??[]).map(e=>({id:e.id,title:e.title,message:e.message,created_at:e.created_at}));y(f)}catch(t){let e=t instanceof Error?t.message:"تعذر تحميل لوحة التحكم.";h.Ay.error(e)}finally{t(!1)}},[]);(0,l.useEffect)(()=>{f()},[f]);let b=(0,l.useMemo)(()=>[{title:"عدد الطلبة",value:c.students,icon:d},{title:"عدد المعلمين",value:c.teachers,icon:n.A},{title:"نسبة الحضور اليوم",value:`${c.attendanceRate}%`,icon:o.A},{title:"الواجبات النشطة",value:c.activeHomework,icon:m}],[c]);return e?(0,a.jsx)("section",{dir:"rtl",className:"flex min-h-[65vh] items-center justify-center",children:(0,a.jsx)("div",{className:"h-11 w-11 animate-spin rounded-full border-4 border-primary-100 border-t-primary-600"})}):r?(0,a.jsxs)("section",{dir:"rtl",className:"space-y-5",children:[(0,a.jsxs)("header",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-primary-700",children:"لوحة التحكم"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"ملخص سريع عن أداء المدرسة اليوم."})]}),(0,a.jsx)("section",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4",children:b.map(({title:e,value:t,icon:r})=>(0,a.jsxs)("article",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,a.jsx)("div",{className:"mb-3 inline-flex h-10 w-10 items-center justify-center rounded-lg bg-primary-100 text-primary-700",children:(0,a.jsx)(r,{className:"h-5 w-5"})}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e}),(0,a.jsx)("p",{className:"mt-1 text-3xl font-extrabold text-gray-900",children:t})]},e))}),(0,a.jsxs)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-primary-700",children:"آخر النشاطات"}),(0,a.jsx)(i(),{href:"/dashboard/reports",className:"text-sm font-semibold text-primary-700 hover:text-primary-800",children:"عرض التقارير"})]}),0===g.length?(0,a.jsxs)("div",{className:"rounded-lg border border-dashed border-primary-200 bg-primary-50 p-6 text-center",children:[(0,a.jsx)("p",{className:"mb-4 text-gray-600",children:"لا توجد نشاطات حديثة حاليًا."}),(0,a.jsx)(i(),{href:"/dashboard/messages",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"بدء التواصل"})]}):(0,a.jsx)("ul",{className:"space-y-3",children:g.map(e=>(0,a.jsxs)("li",{className:"rounded-lg border border-primary-100 bg-beige-50 p-4",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900",children:e.title}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:e.message}),(0,a.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:(0,x.r6)(e.created_at)})]},e.id))})]})]}):(0,a.jsxs)("section",{dir:"rtl",className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,a.jsx)("h1",{className:"mb-3 text-2xl font-bold text-primary-700",children:"لم يتم ربط الحساب بمدرسة"}),(0,a.jsx)("p",{className:"mb-6 text-gray-600",children:"أكمل الإعداد حتى تظهر بيانات لوحة التحكم."}),(0,a.jsx)(i(),{href:"/onboarding",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"إكمال الإعداد"})]})}},7236:(e,t,r)=>{"use strict";r.d(t,{U:()=>s});var a=r(6622);function s(){return(0,a.createBrowserClient)("https://zuppzhysrgmioyozrltp.supabase.co","sb_publishable_GQkKFgomb7ThK_H_csmdoQ_CYQOschE")}},7810:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(2806).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},7882:(e,t,r)=>{Promise.resolve().then(r.bind(r,4461))}},e=>{e.O(0,[143,500,409,441,794,358],()=>e(e.s=7882)),_N_E=e.O()}]);