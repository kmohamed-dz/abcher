(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[396],{1337:(e,t,r)=>{"use strict";r.d(t,{A_:()=>o,Yq:()=>n,cn:()=>i,r6:()=>d});var l=r(9722),s=r(622);function i(...e){return(0,s.QP)((0,l.$)(e))}function a(e){return e instanceof Date?e:new Date(e)}function n(e){let t=a(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric"}).format(t)}function d(e){let t=a(e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("ar-DZ",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}let o=["المبتدئ","جزء عم","جزء تبارك","ثلث القرآن","نصف القرآن","ثلاثة أرباع القرآن","الحفظ الكامل"]},1914:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(2806).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2806:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var l=r(2115);let s=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),i=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)};var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,l.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:n="",children:d,iconNode:o,...c},m)=>(0,l.createElement)("svg",{ref:m,...a,width:t,height:t,stroke:e,strokeWidth:i?24*Number(r)/Number(t):r,className:s("lucide",n),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1})(c)&&{"aria-hidden":"true"},...c},[...o.map(([e,t])=>(0,l.createElement)(e,t)),...Array.isArray(d)?d:[d]])),d=(e,t)=>{let r=(0,l.forwardRef)(({className:r,...a},d)=>(0,l.createElement)(n,{ref:d,iconNode:t,className:s(`lucide-${i(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...a}));return r.displayName=i(e),r}},3210:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(2806).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7236:(e,t,r)=>{"use strict";r.d(t,{U:()=>s});var l=r(6622);function s(){return(0,l.createBrowserClient)("https://zuppzhysrgmioyozrltp.supabase.co","sb_publishable_GQkKFgomb7ThK_H_csmdoQ_CYQOschE")}},9102:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var l=r(5155),s=r(2115),i=r(1914),a=r(8434),n=r(3210),d=r(7236),o=r(1337);let c=(0,d.U)(),m={title:"",level:o.A_[0],description:"",due_date:""};function u({isOpen:e,onClose:t,onSuccess:r,schoolId:i,homework:d}){let[u,h]=(0,s.useState)(m),[x,p]=(0,s.useState)({}),[g,y]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{e&&(d?h({title:d.title,level:d.level,description:d.description||"",due_date:d.due_date||""}):h(m),p({}))},[e,d]),!e)return null;let b=async()=>{let e;if(e={},u.title.trim()||(e.title="عنوان الواجب مطلوب."),u.level.trim()||(e.level="المستوى مطلوب."),p(e),0!==Object.keys(e).length)return void a.Ay.error("تحقق من الحقول المطلوبة.");if(!i)return void a.Ay.error("تعذر معرفة المدرسة الحالية.");y(!0);try{if(d){let{error:e}=await c.from("homework").update({title:u.title.trim(),level:u.level,description:u.description.trim()||null,due_date:u.due_date||null}).eq("id",d.id).eq("school_id",i);if(e)throw e;a.Ay.success("تم تعديل الواجب.")}else{let{error:e}=await c.from("homework").insert([{school_id:i,title:u.title.trim(),level:u.level,description:u.description.trim()||null,due_date:u.due_date||null}]);if(e)throw e;a.Ay.success("تمت إضافة الواجب.")}r()}catch(t){let e=t instanceof Error?t.message:"تعذر حفظ الواجب.";a.Ay.error(e)}finally{y(!1)}};return(0,l.jsx)("div",{dir:"rtl",role:"presentation",onClick:e=>{e.target===e.currentTarget&&t()},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:(0,l.jsxs)("div",{className:"w-full max-w-xl rounded-xl bg-white p-6 shadow-md",children:[(0,l.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-primary-700",children:d?"تعديل واجب":"إضافة واجب"}),(0,l.jsx)("button",{type:"button",onClick:t,"aria-label":"إغلاق",className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-gray-200 text-gray-600 hover:bg-gray-100",children:(0,l.jsx)(n.A,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"hw-title",className:"mb-1 block text-sm font-semibold text-gray-700",children:"عنوان الواجب"}),(0,l.jsx)("input",{id:"hw-title",value:u.title,onChange:e=>h(t=>({...t,title:e.target.value})),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring",placeholder:"أدخل عنوانًا واضحًا"}),x.title?(0,l.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.title}):null]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"hw-level",className:"mb-1 block text-sm font-semibold text-gray-700",children:"المستوى"}),(0,l.jsx)("select",{id:"hw-level",value:u.level,onChange:e=>h(t=>({...t,level:e.target.value})),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring",children:o.A_.map(e=>(0,l.jsx)("option",{value:e,children:e},e))}),x.level?(0,l.jsx)("p",{className:"mt-1 text-sm text-red-600",children:x.level}):null]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"hw-due-date",className:"mb-1 block text-sm font-semibold text-gray-700",children:"تاريخ التسليم"}),(0,l.jsx)("input",{id:"hw-due-date",type:"date",value:u.due_date,onChange:e=>h(t=>({...t,due_date:e.target.value})),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"hw-description",className:"mb-1 block text-sm font-semibold text-gray-700",children:"وصف الواجب"}),(0,l.jsx)("textarea",{id:"hw-description",rows:4,value:u.description,onChange:e=>h(t=>({...t,description:e.target.value})),className:"w-full rounded-lg border border-gray-200 px-3 py-3 text-[16px] outline-none ring-primary-200 focus:ring",placeholder:"وصف مختصر للتكليف"})]})]}),(0,l.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:t,className:"min-h-[44px] rounded-lg border border-gray-200 px-4 py-2 text-gray-700 hover:bg-gray-100",children:"إلغاء"}),(0,l.jsx)("button",{type:"button",disabled:g,onClick:()=>{b()},className:"min-h-[44px] rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700 disabled:opacity-60",children:g?"جارٍ الحفظ...":"حفظ"})]})]})})}let h=(0,d.U)();function x(){let[e,t]=(0,s.useState)(!0),[r,n]=(0,s.useState)(null),[d,c]=(0,s.useState)(null),[m,x]=(0,s.useState)([]),[p,g]=(0,s.useState)(!1),[y,b]=(0,s.useState)(null),f="school_admin"===d||"teacher"===d,w=(0,s.useCallback)(async()=>{t(!0);try{let{data:{user:e}}=await h.auth.getUser();if(!e)throw Error("يرجى تسجيل الدخول أولًا.");let{data:t,error:r}=await h.from("profiles").select("school_id, role").eq("id",e.id).single();if(r)throw r;if(c(t?.role??null),!t?.school_id){n(null),x([]);return}n(t.school_id);let{data:l,error:s}=await h.from("homework").select("id,school_id,title,level,description,due_date,created_at").eq("school_id",t.school_id).order("due_date",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!1});if(s)throw s;x(l??[])}catch(t){let e=t instanceof Error?t.message:"تعذر تحميل الواجبات.";a.Ay.error(e)}finally{t(!1)}},[]);(0,s.useEffect)(()=>{w()},[w]);let j=(0,s.useMemo)(()=>{let e=new Map;return m.forEach(t=>{let r=t.due_date||"بدون تاريخ",l=e.get(r)||[];l.push(t),e.set(r,l)}),Array.from(e.entries()).map(([e,t])=>({dueDate:e,list:t}))},[m]),N=async e=>{if(r&&f&&window.confirm(`هل تريد حذف الواجب: ${e.title}؟`))try{let{error:t}=await h.from("homework").delete().eq("id",e.id).eq("school_id",r);if(t)throw t;a.Ay.success("تم حذف الواجب."),await w()}catch(t){let e=t instanceof Error?t.message:"تعذر حذف الواجب.";a.Ay.error(e)}};return e?(0,l.jsx)("section",{dir:"rtl",className:"flex min-h-[65vh] items-center justify-center",children:(0,l.jsx)("div",{className:"h-11 w-11 animate-spin rounded-full border-4 border-primary-100 border-t-primary-600"})}):r?(0,l.jsxs)("section",{dir:"rtl",className:"space-y-5",children:[(0,l.jsx)("header",{className:"rounded-xl bg-white p-6 shadow-md",children:(0,l.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-primary-700",children:"الواجبات"}),(0,l.jsx)("p",{className:"mt-2 text-gray-600",children:"تنظيم الواجبات حسب تاريخ التسليم."})]}),f?(0,l.jsxs)("button",{type:"button",onClick:()=>{b(null),g(!0)},className:"inline-flex min-h-[44px] items-center justify-center gap-2 rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:[(0,l.jsx)(i.A,{className:"h-4 w-4"}),"إضافة واجب"]}):null]})}),0===m.length?(0,l.jsxs)("section",{className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,l.jsx)("p",{className:"mb-4 text-gray-600",children:"لا توجد واجبات مسجلة حاليًا."}),f?(0,l.jsx)("button",{type:"button",onClick:()=>{b(null),g(!0)},className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"إضافة أول واجب"}):null]}):j.map(e=>(0,l.jsxs)("section",{className:"rounded-xl bg-white p-6 shadow-md",children:[(0,l.jsx)("h2",{className:"mb-4 text-lg font-bold text-primary-700",children:"بدون تاريخ"===e.dueDate?"بدون تاريخ تسليم":`تاريخ التسليم: ${(0,o.Yq)(e.dueDate)}`}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:e.list.map(e=>(0,l.jsxs)("article",{className:"rounded-lg border border-primary-100 bg-beige-50 p-4",children:[(0,l.jsxs)("div",{className:"mb-2 flex items-start justify-between gap-2",children:[(0,l.jsx)("h3",{className:"text-base font-bold text-gray-900",children:e.title}),(0,l.jsx)("span",{className:"rounded-full bg-primary-100 px-3 py-1 text-xs font-semibold text-primary-700",children:e.level})]}),(0,l.jsx)("p",{className:"text-sm leading-7 text-gray-700",children:e.description||"لا يوجد وصف إضافي."}),f?(0,l.jsxs)("div",{className:"mt-3 flex flex-wrap justify-end gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{b(e),g(!0)},className:"min-h-[44px] rounded-lg bg-yellow-500 px-3 py-2 text-sm text-white",children:"تعديل"}),(0,l.jsx)("button",{type:"button",onClick:()=>{N(e)},className:"min-h-[44px] rounded-lg bg-red-600 px-3 py-2 text-sm text-white",children:"حذف"})]}):(0,l.jsx)("p",{className:"mt-3 text-sm text-gray-500",children:"عرض فقط"})]},e.id))})]},e.dueDate)),(0,l.jsx)(u,{isOpen:p,onClose:()=>g(!1),onSuccess:()=>{g(!1),w()},schoolId:r,homework:y})]}):(0,l.jsxs)("section",{dir:"rtl",className:"rounded-xl bg-white p-6 text-center shadow-md",children:[(0,l.jsx)("h1",{className:"mb-3 text-2xl font-bold text-primary-700",children:"لا توجد مدرسة مرتبطة"}),(0,l.jsx)("p",{className:"mb-6 text-gray-600",children:"أكمل الإعداد لبدء إدارة الواجبات."}),(0,l.jsx)("a",{href:"/onboarding",className:"inline-flex min-h-[44px] items-center justify-center rounded-lg bg-primary-600 px-4 py-2 text-white hover:bg-primary-700",children:"إكمال الإعداد"})]})}},9693:(e,t,r)=>{Promise.resolve().then(r.bind(r,9102))}},e=>{e.O(0,[143,409,441,794,358],()=>e(e.s=9693)),_N_E=e.O()}]);